<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Converso Pro V11 - Dark Edition</title>
<style>
  /* --- STYLE TH√àME SOMBRE STRICTEMENT RESTAUR√â --- */
  body { 
    font-family: 'Inter', sans-serif; 
    background-color: #0f172a; /* Bleu fonc√© */
    color: #cbd5e1; /* Gris clair */
    line-height: 1.6; 
    display: flex; 
    justify-content: center; 
    align-items: flex-start; 
    padding: 20px;
    min-height: 100vh;
  }
  .container { 
    display: flex; 
    flex-direction: column;
    width: 100%;
    max-width: 1200px; 
    background-color: #1e293b; /* Gris-bleu fonc√© */
    border-radius: 12px; 
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5); 
    overflow: hidden; 
    min-height: 80vh; /* Assure que le footer est bien visible en bas */
  }
  header { 
    background-color: #334155; 
    color: #f8fafc; 
    padding: 20px 30px; 
    border-bottom: 3px solid #38bdf8; 
    position: relative; 
  }
  h1 { margin: 0; font-size: 2.5em; font-weight: 700; }
  .subtitle { font-size: 1em; opacity: 0.8; margin-top: 5px; color: #94a3b8; }
  .main-content { display: flex; flex-grow: 1; }

  /* SIDEBAR ET NAVIGATION */
  .sidebar { 
    width: 250px; 
    background-color: #1f2937; 
    padding: 10px 0; 
    flex-shrink: 0;
    border-right: 1px solid rgba(100, 116, 139, 0.3);
  }
  .nav-btn { 
    display: block; 
    width: 100%; 
    padding: 14px 25px; 
    margin: 4px 0;
    background: none; 
    border: none; 
    color: #e2e8f0; 
    text-align: left; 
    font-size: 1em; 
    cursor: pointer; 
    transition: background-color 0.2s, color 0.2s, border-left 0.2s; 
    font-weight: 500;
  }
  .nav-btn:hover { 
    background-color: #334155; 
    color: #38bdf8;
  }
  .nav-btn.active { 
    background-color: #334155; 
    color: #38bdf8; 
    font-weight: bold; 
    border-left: 5px solid #38bdf8; 
    padding-left: 20px; 
  }
  
  .content { flex-grow: 1; padding: 30px; }
  .section { display: none; }
  .section.active { display: block; }
  
  h2 { 
    color: #f8fafc; 
    border-bottom: 2px solid #334155; 
    padding-bottom: 15px; 
    margin-top: 0; 
    font-size: 1.8em;
  }
  .form-group { margin-bottom: 25px; }
  label { 
    display: block; 
    margin-bottom: 10px; 
    font-weight: 600; 
    color: #94a3b8; 
    font-size: 0.95em;
  }
  
  /* INPUTS/SELECTS */
  input[type="text"], input[type="number"], select { 
    width: 100%; 
    padding: 12px 15px; 
    background-color: #334155; 
    border: 1px solid #475569; 
    border-radius: 8px; 
    box-sizing: border-box; 
    font-size: 1em; 
    color: #f8fafc; 
    transition: border-color 0.2s;
  }
  input[type="text"]:focus, input[type="number"]:focus, select:focus {
    border-color: #38bdf8;
    outline: none;
    box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
  }
  
  /* BOUTONS ACTIONS */
  button.action-btn { 
    background: linear-gradient(135deg, #38bdf8, #0ea5e9);
    color: white; 
    padding: 12px 25px; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer; 
    font-size: 1em; 
    font-weight: 600;
    transition: transform 0.1s, box-shadow 0.2s; 
    margin-top: 15px; 
    width: 100%; 
  }
  button.action-btn:hover { 
    box-shadow: 0 4px 10px rgba(56, 189, 248, 0.4); 
    transform: translateY(-1px);
  }
  
  /* RESULTAT BOX */
  .result-box { 
    margin-top: 30px; 
    padding: 20px; 
    border: 2px solid #38bdf8; 
    border-radius: 10px; 
    background-color: #0f172a; 
  }
  .result-box h3 { margin: 0 0 10px 0; color: #38bdf8; font-size: 1.3em; }
  .result-box p { color: #94a3b8; margin-bottom: 5px; }
  .result-box code { 
    display: block; 
    background-color: #1e293b; 
    padding: 10px; 
    border-radius: 6px; 
    font-family: 'Consolas', 'Monospace'; 
    overflow-x: auto; 
    white-space: pre-wrap; 
    color: #facc15; 
    font-size: 0.9em;
    border: 1px dashed #334155;
  }
  
  .explanation-box {
    margin-bottom: 25px;
    padding: 15px;
    background-color: #1e293b;
    border-left: 4px solid #8b5cf6; 
    border-radius: 4px;
    color: #cbd5e1;
  }
  .explanation-box h4 { color: #8b5cf6; margin: 0 0 10px 0; font-size: 1.1em; }
  .explanation-box p { margin-bottom: 10px; font-size: 0.95em; }

  /* WIDGET NOTE APP */
  .rating-stats-widget { 
    position: absolute; top: 20px; right: 30px; 
    background-color: rgba(56, 189, 248, 0.1); padding: 10px 15px; 
    border-radius: 8px; text-align: center; border: 1px solid #38bdf8;
    cursor: pointer;
    transition: transform 0.2s;
  }
  .rating-stats-widget:hover { transform: scale(1.05); }
  .current-rating { font-size: 1.8em; font-weight: bold; line-height: 1; color: #facc15; }

  /* POPUP NOTATION */
  .modal-overlay {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(15, 23, 42, 0.95);
    display: none; justify-content: center; align-items: center; z-index: 2000;
  }
  .rating-modal {
    background-color: #1e293b; padding: 30px; border-radius: 16px;
    text-align: center; border: 1px solid #38bdf8;
    box-shadow: 0 0 30px rgba(56, 189, 248, 0.2);
    max-width: 400px; width: 90%;
  }
  .star-container { font-size: 40px; color: #475569; margin: 20px 0; cursor: pointer; }
  .star { transition: color 0.2s; display: inline-block; padding: 0 5px; }
  .star:hover, .star.hovered, .star.selected { color: #facc15; }
  
  /* GRAPHIQUE STATS */
  .stats-container {
    background: #0f172a; padding: 20px; border-radius: 12px; margin-top: 20px;
    border: 1px solid #334155;
  }
  .stat-row { display: flex; align-items: center; margin-bottom: 10px; }
  .stat-label { width: 50px; font-weight: bold; color: #94a3b8; }
  .stat-bar-bg { flex-grow: 1; height: 10px; background: #334155; border-radius: 5px; margin: 0 10px; overflow: hidden; }
  .stat-bar-fill { height: 100%; background: linear-gradient(90deg, #facc15, #f59e0b); width: 0%; transition: width 1s ease-out; }
  .stat-count { width: 40px; text-align: right; color: #f8fafc; font-size: 0.9em; }
  
  /* Classes pour les boutons radios */
  .radio-group { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
  .radio-label { display: flex; align-items: center; cursor: pointer; padding: 10px 15px; background: rgba(51, 65, 85, 0.6); border: 1px solid rgba(100, 116, 139, 0.3); border-radius: 8px; color: #e2e8f0; }
  .radio-label.active { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; border-color: #8b5cf6; }
  .operation-selector { margin: 15px 0; display: flex; gap: 15px; }

  /* CONSENT & POPUP */
  .consent-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(15, 23, 42, 0.9); display: flex; justify-content: center; align-items: center; z-index: 1000; }
  .consent-content { background-color: #1e293b; padding: 30px; border-radius: 12px; max-width: 500px; text-align: center; border: 1px solid #334155; }
  .btn-accept { background: linear-gradient(135deg, #10b981, #059669); color: white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;}
  .btn-refuse { background: linear-gradient(135deg, #f43f5e, #e11d48); color: white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;}

  /* FOOTER */
  footer {
    padding: 15px 30px;
    background-color: #1f2937;
    border-top: 1px solid #334155;
    text-align: center;
    font-size: 0.9em;
    color: #64748b;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  footer a {
    color: #38bdf8;
    text-decoration: none;
    transition: color 0.2s;
  }
  footer a:hover {
    color: #93c5fd;
    text-decoration: underline;
  }
  .footer-left a { 
      font-weight: 600; 
      cursor: pointer; 
      padding: 5px 10px; 
      border-radius: 4px; 
      transition: background-color 0.2s;
  }
  .footer-left a:hover {
      background-color: #334155;
  }
  .donate-btn {
    background: linear-gradient(135deg, #facc15, #f59e0b);
    color: #1e293b;
    padding: 8px 15px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 700;
    transition: transform 0.1s, box-shadow 0.2s;
    font-size: 0.9em;
  }
  .donate-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(250, 204, 21, 0.5);
  }
  
  /* MODAL INFO CCP */
  .ccp-modal {
    background-color: #1e293b; 
    padding: 30px; 
    border-radius: 16px;
    text-align: left; 
    border: 1px solid #facc15;
    box-shadow: 0 0 30px rgba(250, 204, 21, 0.2);
    max-width: 400px; 
    width: 90%;
  }
  .ccp-modal h3 { color: #facc15; margin-top: 0; border-bottom: 1px dashed #334155; padding-bottom: 10px;}
  .ccp-info { margin: 15px 0; font-size: 1.1em; }
  .ccp-info strong { color: #cbd5e1; display: inline-block; width: 100px; }


  /* MEDIA QUERIES */
  @media (max-width: 768px) {
    .container { flex-direction: column; border-radius: 0; }
    .main-content { flex-direction: column; }
    .sidebar { width: 100%; overflow-x: auto; flex-direction: row; border-right: none; border-bottom: 1px solid rgba(100, 116, 139, 0.3); }
    .nav-btn { flex-shrink: 0; width: auto; padding: 10px 15px; border-left: none !important; border-bottom: 3px solid #38bdf8; }
    .nav-btn.active { border-left: none !important; border-bottom: 3px solid #38bdf8; background-color: #334155; }
    .rating-stats-widget { position: static; margin-top: 15px; background-color: #1e293b; }
    footer { flex-direction: column; gap: 10px; }
  }
  select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2338bdf8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 16px center; background-size: 20px; padding-right: 50px; }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1 title="Converso Pro V11">Converso Pro</h1>
    <div class="subtitle">Outils avanc√©s de conversion num√©rique & P√©dagogie</div>
    <!-- Ajout onclick explicite pour ouvrir la popup -->
    <div class="rating-stats-widget" id="rating-stats-widget" onclick="openRatingPopup()">
      <h4 style="margin:0; color:#94a3b8; font-size:0.9em">Note App</h4>
      <div class="current-rating" id="header-rating">--</div>
      <div style="font-size:0.8em; color:#94a3b8" id="header-votes">0 avis</div>
    </div>
  </header>
  <div class="main-content">
    <div class="sidebar">
      <button class="nav-btn active" data-section="entiers">Nombres Entiers</button>
      <button class="nav-btn" data-section="virgule-fixe">Virgule Fixe</button>
      <button class="nav-btn" data-section="virgule-flottante">Virgule Flottante</button>
      <button class="nav-btn" data-section="conversion-base">Conversion S√©rie</button>
      <button class="nav-btn" data-section="multi-bases">Tableau Multi-Bases</button>
      <button class="nav-btn" data-section="operations">Op√©rations</button>
      <button class="nav-btn" data-section="stats-avis" style="color:#facc15;">‚≠ê Statistiques & Avis</button>
    </div>
    <div class="content">
      
      <!-- Section Nombres Entiers -->
      <div id="entiers" class="section active">
        <h2>Conversion Nombres Entiers (Compl√©ment √† 2)</h2>
        <div class="explanation-box">
            <h4>üí° Comprendre le Compl√©ment √† Deux (C2)</h4>
            <p>Le compl√©ment √† deux est la m√©thode standard pour repr√©senter les entiers sign√©s en binaire.</p>
        </div>
        <div class="form-group">
          <label for="entier-input">Nombre :</label>
          <input type="text" id="entier-input" value="-13" placeholder="Ex: -13, 10110" />
        </div>
        <div class="form-group">
          <label for="entier-base">Base source :</label>
          <select id="entier-base">
            <option value="10" selected>D√©cimal (10)</option>
            <option value="2">Binaire (2)</option>
            <option value="16">Hexad√©cimal (16)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="bits-input">Taille (Bits) :</label>
          <select id="bits-input">
            <option value="8">8 bits</option>
            <option value="16">16 bits</option>
            <option value="32" selected>32 bits</option>
            <option value="64">64 bits</option>
          </select>
        </div>
        <button class="action-btn" id="btn-entier">Convertir en Compl√©ment √† Deux</button>
        <div id="entier-result"></div>
      </div>

      <!-- Section Virgule Fixe -->
      <div id="virgule-fixe" class="section">
        <h2>Conversion Virgule Fixe (Q Format)</h2>
        <div class="form-group">
          <label for="reel-input">Nombre r√©el :</label>
          <input type="number" step="any" id="reel-input" value="13.625" />
        </div>
        <div class="form-group">
          <label for="bits-entier">Bits partie enti√®re :</label>
          <input type="number" id="bits-entier" value="8" min="1" />
        </div>
        <div class="form-group">
          <label for="bits-fraction">Bits partie fractionnaire :</label>
          <input type="number" id="bits-fraction" value="8" min="0" />
        </div>
        <button class="action-btn" id="btn-virgule-fixe">Convertir</button>
        <div id="virgule-fixe-result"></div>
      </div>

      <!-- Section Virgule Flottante -->
      <div id="virgule-flottante" class="section">
        <h2>Conversion Virgule Flottante IEEE 754</h2>
        <div class="form-group">
          <label for="float-input">Nombre r√©el :</label>
          <input type="number" step="any" id="float-input" value="-13.625" />
        </div>
        <label>Pr√©cision :</label>
        <div class="radio-group" id="float-precision">
          <label class="radio-label active"><input type="radio" name="precision" value="simple" checked> Simple</label>
          <label class="radio-label"><input type="radio" name="precision" value="double"> Double</label>
          <label class="radio-label"><input type="radio" name="precision" value="half"> Demi</label>
        </div>
        <button class="action-btn" id="btn-virgule-flottante">Convertir</button>
        <div id="virgule-flottante-result"></div>
      </div>

      <!-- Section Conversion S√©rie -->
      <div id="conversion-base" class="section">
        <h2>Conversion de Base D√©taill√©e</h2>
        <div class="form-group">
          <label for="gen-input">Valeur √† convertir :</label>
          <input type="text" id="gen-input" value="255" />
        </div>
        <div class="form-group">
          <label for="gen-base-source">Base source :</label>
          <input type="number" id="gen-base-source" value="10" min="2" max="36" />
        </div>
        <div class="form-group">
          <label for="gen-base-cible">Base cible :</label>
          <input type="number" id="gen-base-cible" value="16" min="2" max="36" />
        </div>
        <button class="action-btn" id="btn-gen-base">Afficher les √©tapes</button>
        <div id="gen-base-result"></div>
      </div>

      <!-- Section Tableau Multi-Bases -->
      <div id="multi-bases" class="section">
        <h2>Tableau Multi-Bases</h2>
        <div class="form-group">
            <label for="multibase-input">Nombre √† analyser :</label>
            <input type="text" id="multibase-input" placeholder="Ex: 123 ou 10101" />
        </div>
        <div class="form-group">
            <label for="multibase-from">Base d'origine :</label>
            <select id="multibase-from">
                <option value="10">D√©cimal (10)</option>
                <option value="2">Binaire (2)</option>
                <option value="8">Octal (8)</option>
                <option value="16">Hexad√©cimal (16)</option>
            </select>
        </div>
        <button class="action-btn" id="btn-multibase">G√©n√©rer le Tableau</button>
        <div id="multibase-result"></div>
      </div>

      <!-- Section Op√©rations (MISE √Ä JOUR) -->
      <div id="operations" class="section">
        <h2>Op√©rations Arithm√©tiques D√©taill√©es</h2>
        
        <div class="form-group"><label>Op√©rande 1 (Valeur) :</label><input type="text" id="op-val1" value="5" /></div>
        <div class="form-group">
            <label for="op-base1">Base Source Op√©rande 1 :</label>
            <select id="op-base1">
                <option value="10" selected>D√©cimal (10)</option>
                <option value="2">Binaire (2)</option>
                <option value="8">Octal (8)</option>
                <option value="16">Hexad√©cimal (16)</option>
            </select>
        </div>

        <div class="operation-selector">
          <label class="radio-label active"><input type="radio" name="operation" value="add" checked> Addition (+)</label>
          <label class="radio-label"><input type="radio" name="operation" value="sub"> Soustraction (-)</label>
        </div>

        <div class="form-group"><label>Op√©rande 2 (Valeur) :</label><input type="text" id="op-val2" value="3" /></div>
        <div class="form-group">
            <label for="op-base2">Base Source Op√©rande 2 :</label>
            <select id="op-base2">
                <option value="10" selected>D√©cimal (10)</option>
                <option value="2">Binaire (2)</option>
                <option value="8">Octal (8)</option>
                <option value="16">Hexad√©cimal (16)</option>
            </select>
        </div>
        
        <div class="form-group">
          <label>Taille mot (bits) :</label>
          <select id="op-bits"><option value="8" selected>8 bits</option><option value="16">16 bits</option><option value="32">32 bits</option></select>
        </div>
        
        <div class="form-group">
            <label for="op-representation">Type de Repr√©sentation (Format d'affichage du r√©sultat) :</label>
            <select id="op-representation">
                <option value="C2" selected>Compl√©ment √† 2 (C2)</option>
                <option value="SVA">Signe-Valeur Absolue (SVA)</option>
                <option value="C1">Compl√©ment √† 1 (C1)</option>
                <option value="GRAY">Code Gray (Non Arithm√©tique)</option>
                <option value="EXCESS3">Excess-3 (Code BCD)</option>
            </select>
        </div>

        <button class="action-btn" id="btn-operations">Calculer & Afficher la Repr√©sentation</button>
        <div id="operations-result"></div>
      </div>

      <!-- NOUVELLE SECTION STATISTIQUES & AVIS -->
      <div id="stats-avis" class="section">
        <h2>üìä Statistiques des Avis</h2>
        <div class="explanation-box">
            <div style="text-align:center; padding: 20px;">
                <h4 style="color:#facc15; font-size: 2.5em; margin:0;" id="stat-average-big">--</h4>
                <div style="color:#94a3b8; margin-top:5px;">Note moyenne g√©n√©rale</div>
                <div style="font-size:1.5em; color:#facc15;" id="stat-stars-display">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                <div style="color:#cbd5e1; margin-top:5px;" id="stat-total-big">0 avis</div>
                
                <!-- BOUTON D'ACTION PRINCIPAL POUR VOTER -->
                <button class="action-btn" onclick="openRatingPopup()" style="max-width:200px; margin:20px auto; display:block; background: linear-gradient(135deg, #f59e0b, #d97706);">
                    ‚≠ê Noter l'application
                </button>
            </div>
        </div>

        <div class="stats-container">
            <h3>R√©partition des notes</h3>
            <div class="stat-row">
                <span class="stat-label">5 ‚òÖ</span>
                <div class="stat-bar-bg"><div class="stat-bar-fill" id="bar-5" style="width:0%"></div></div>
                <span class="stat-count" id="count-5">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">4 ‚òÖ</span>
                <div class="stat-bar-bg"><div class="stat-bar-fill" id="bar-4" style="width:0%"></div></div>
                <span class="stat-count" id="count-4">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">3 ‚òÖ</span>
                <div class="stat-bar-bg"><div class="stat-bar-fill" id="bar-3" style="width:0%"></div></div>
                <span class="stat-count" id="count-3">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">2 ‚òÖ</span>
                <div class="stat-bar-bg"><div class="stat-bar-fill" id="bar-2" style="width:0%"></div></div>
                <span class="stat-count" id="count-2">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">1 ‚òÖ</span>
                <div class="stat-bar-bg"><div class="stat-bar-fill" id="bar-1" style="width:0%"></div></div>
                <span class="stat-count" id="count-1">0</span>
            </div>
        </div>

        <div style="text-align:center; margin-top:30px;">
            <p id="user-vote-status" style="color:#94a3b8; margin-bottom:15px; font-style:italic;">Vous n'avez pas encore not√© cette application.</p>
            <button class="action-btn" onclick="resetVote()" style="background: linear-gradient(135deg, #64748b, #475569); max-width:250px;">
                ‚Ü∫ R√©initialiser mon vote
            </button>
        </div>
      </div>

    </div>
  </div>
  
  <!-- FOOTER AJOUT√â ICI -->
  <footer>
    <div class="footer-left">
        ¬© 2025. Cod√© par <a href="mailto:promaildzaier@gmail.com" title="Envoyer un email au d√©veloppeur">LG_Ghazel</a>
    </div>
    <div class="footer-right">
        <button class="donate-btn" onclick="showCcpInfo()">
            Faire un Don (CCP)
        </button>
    </div>
  </footer>
  
</div>

<!-- POPUP DE NOTATION -->
<div id="rating-modal" class="modal-overlay">
  <div class="rating-modal">
    <h3 style="color:#f8fafc; margin-top:0;">√âvaluez Converso Pro</h3>
    <p style="color:#94a3b8;">Votre avis nous aide √† nous am√©liorer !</p>
    <div class="star-container" id="star-container">
      <span class="star" data-value="1">‚òÖ</span>
      <span class="star" data-value="2">‚òÖ</span>
      <span class="star" data-value="3">‚òÖ</span>
      <span class="star" data-value="4">‚òÖ</span>
      <span class="star" data-value="5">‚òÖ</span>
    </div>
    <div style="display:flex; justify-content:center; gap:10px;">
        <button onclick="closeRatingPopup()" style="background:transparent; border:1px solid #475569; color:#94a3b8; padding:8px 15px; border-radius:6px; cursor:pointer;">Fermer</button>
    </div>
  </div>
</div>

<!-- POPUP INFO CCP (DON) -->
<div id="ccp-modal" class="modal-overlay">
  <div class="ccp-modal">
    <h3>üíö Informations de Don (CCP)</h3>
    <p style="color:#94a3b8;">Merci pour votre soutien !</p>
    <div class="ccp-info">
        <strong>CCP :</strong> <code id="ccp-number">43936110</code>
    </div>
    <div class="ccp-info">
        <strong>Cl√© :</strong> <code id="ccp-key">32</code>
    </div>
    <div class="ccp-info">
        <strong>Baridimob :</strong> <code id="ccp-baridimob">00799999004393611035</code>
    </div>
    <button onclick="closeCcpInfo()" class="action-btn" style="background: linear-gradient(135deg, #38bdf8, #0ea5e9); max-width:100px; margin-top: 20px;">
        Fermer
    </button>
  </div>
</div>

<!-- CONSENTEMENT -->
<div id="consent-popup" class="consent-overlay">
  <div class="consent-content">
    <div class="consent-text">üç™ Statistiques anonymes pour am√©liorer l'app ?</div>
    <div class="consent-buttons">
      <button class="btn-accept" onclick="acceptCookies()">Accepter</button>
      <button class="btn-refuse" onclick="refuseCookies()">Refuser</button>
    </div>
  </div>
</div>

<script>
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyhtGkq-AsuAJsoffStA2y3K5IioIQZNIQiACnGHfKrb8zhDTCUyvJ3asdGPKCoiF5k6w/exec";
let userIP = "Non autoris√©", consentGiven = false, sessionID = Date.now().toString(36) + Math.random().toString(36).substr(2);
let currentRating = 0;

const els = {
    entier: document.getElementById('entier-input'),
    reel: document.getElementById('reel-input'),
    float: document.getElementById('float-input'),
    gen: document.getElementById('gen-input'),
    multibase: document.getElementById('multibase-input'),
    entierBase: document.getElementById('entier-base'),
    bitsInput: document.getElementById('bits-input'),
    bitsEntier: document.getElementById('bits-entier'),
    bitsFraction: document.getElementById('bits-fraction'),
    genBaseSource: document.getElementById('gen-base-source'),
    genBaseCible: document.getElementById('gen-base-cible'),
    multibaseFrom: document.getElementById('multibase-from'),
    opVal1: document.getElementById('op-val1'),
    opVal2: document.getElementById('op-val2'),
    opBase1: document.getElementById('op-base1'), // Nouveau
    opBase2: document.getElementById('op-base2'), // Nouveau
    opBits: document.getElementById('op-bits'),
    opRepresentation: document.getElementById('op-representation') // Nouveau
};

const sanitize = v => String(v).replace(/[<>"'&]/g, '').toUpperCase();
const sendData = (type, valeur) => {
  if (!consentGiven && type !== 'VOTE') return; 
  fetch(GOOGLE_SCRIPT_URL, {
    method: 'POST', mode: 'no-cors',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({type, valeur, ip: userIP, session: sessionID})
  }).catch(() => {});
};

document.addEventListener('DOMContentLoaded', () => {
  initApp();
  
  // Animation Radio
  document.querySelectorAll('.radio-group input[type="radio"], .operation-selector input[type="radio"]').forEach(radio => {
    radio.addEventListener('change', () => {
      document.querySelectorAll(`input[name="${radio.name}"]`).forEach(r => r.closest('.radio-label').classList.remove('active'));
      radio.closest('.radio-label').classList.add('active');
    });
  });

  // Gestion des √©toiles
  const stars = document.querySelectorAll('.star');
  stars.forEach(star => {
    star.addEventListener('mouseover', function() {
        const val = this.dataset.value;
        stars.forEach(s => s.classList.toggle('hovered', s.dataset.value <= val));
    });
    star.addEventListener('mouseout', function() {
        stars.forEach(s => s.classList.remove('hovered'));
    });
    star.addEventListener('click', function() {
        submitVote(this.dataset.value);
    });
  });

  // Popup automatique apr√®s 3 secondes si pas vot√©
  setTimeout(() => {
    if(!localStorage.getItem('userVoted') && consentGiven) {
        openRatingPopup();
    }
  }, 3000);
});

async function initApp() {
  await fetchUserIP();
  initNavigation();
  initButtons();
  checkConsent();
  loadStatistics();
  
  if(localStorage.getItem('userVoted')) {
      const note = localStorage.getItem('userVotedNote');
      document.getElementById('user-vote-status').innerText = `Vous avez d√©j√† not√© : ${note}/5 ‚òÖ`;
      document.getElementById('user-vote-status').style.color = '#10b981';
  }
}

function initNavigation() {
  document.querySelectorAll('.nav-btn').forEach(b => {
    b.onclick = () => {
      document.querySelectorAll('.nav-btn').forEach(x => x.classList.remove('active'));
      b.classList.add('active');
      document.querySelectorAll('.section').forEach(x => x.classList.remove('active'));
      const sectionId = b.dataset.section;
      const sectionEl = document.getElementById(sectionId);
      if(sectionEl) sectionEl.classList.add('active');
      sendData('SECTIONVIEW', sectionId);
    };
  });
}

function initButtons() {
  document.getElementById('btn-entier').onclick = convertEntier;
  document.getElementById('btn-virgule-fixe').onclick = convertVirguleFixe;
  document.getElementById('btn-virgule-flottante').onclick = convertVirguleFlottante;
  document.getElementById('btn-gen-base').onclick = convertGenBaseSeries; 
  document.getElementById('btn-multibase').onclick = convertMultiBase;
  document.getElementById('btn-operations').onclick = calculateOperations;
}

// LOGIQUE CCP MODALE (Don)
window.showCcpInfo = function() {
    document.getElementById('ccp-modal').style.display = 'flex';
}
window.closeCcpInfo = function() {
    document.getElementById('ccp-modal').style.display = 'none';
}


// LOGIQUE DE VOTE
window.openRatingPopup = function() {
    // MODIFICATION: Ouvre la popup m√™me si on a d√©j√† vot√©, mais informe l'utilisateur
    if(localStorage.getItem('userVoted')) {
        const note = localStorage.getItem('userVotedNote');
        const modal = document.getElementById('rating-modal');
        modal.querySelector('h3').textContent = `Modifier votre note (actuelle : ${note}/5)`;
    }
    document.getElementById('rating-modal').style.display = 'flex';
}

window.closeRatingPopup = function() {
    document.getElementById('rating-modal').style.display = 'none';
}

window.submitVote = function(stars) {
    
    // Si l'utilisateur a d√©j√† vot√©, on reset d'abord pour remplacer l'ancienne note
    if(localStorage.getItem('userVoted')) {
         localStorage.removeItem('userVoted');
         localStorage.removeItem('userVotedNote');
    }
    
    sendData('VOTE', stars);
    
    localStorage.setItem('userVoted', 'true');
    localStorage.setItem('userVotedNote', stars);
    
    closeRatingPopup();
    // Utiliser la modale CCP comme modale g√©n√©rique pour l'info de vote
    document.getElementById('ccp-modal').querySelector('h3').textContent = "Merci !";
    document.getElementById('ccp-modal').querySelector('p').textContent = `Votre note de ${stars} √©toiles a √©t√© enregistr√©e.`;
    document.getElementById('ccp-modal').style.display = 'flex';
    
    document.getElementById('user-vote-status').innerText = `Vous avez d√©j√† not√© : ${stars}/5 ‚òÖ`;
    document.getElementById('user-vote-status').style.color = '#10b981';
    
    // R√©tablir la modale CCP √† son √©tat initial apr√®s l'affichage du merci
    setTimeout(() => {
        closeCcpInfo();
        document.getElementById('ccp-modal').querySelector('h3').textContent = "üíö Informations de Don (CCP)";
        document.getElementById('ccp-modal').querySelector('p').textContent = `Merci pour votre soutien !`;
    }, 3000);
    
    setTimeout(loadStatistics, 1000);
}

window.resetVote = function() {
    // Fonction de nettoyage
    localStorage.removeItem('userVoted');
    localStorage.removeItem('userVotedNote');
    document.getElementById('user-vote-status').innerText = "Vous n'avez pas encore not√© cette application.";
    document.getElementById('user-vote-status').style.color = '#94a3b8';
    document.getElementById('rating-modal').querySelector('h3').textContent = `√âvaluez Converso Pro`;
    
    // Ouvre directement la popup pour revoter
    document.getElementById('rating-modal').style.display = 'flex';
}

// COOKIES
window.acceptCookies = function() {
  localStorage.setItem('cookieConsent', 'true');
  consentGiven = true;
  document.getElementById('consent-popup').style.display = 'none';
  sendData('CONSENT', 'Accepted');
};
window.refuseCookies = function() {
  localStorage.setItem('cookieConsent', 'false');
  document.getElementById('consent-popup').style.display = 'none';
};

function checkConsent() {
  if(localStorage.getItem('cookieConsent') === 'true') {
    consentGiven = true;
    document.getElementById('consent-popup').style.display = 'none';
  } else {
    document.getElementById('consent-popup').style.display = 'flex';
  }
}
async function fetchUserIP() {
  try {
    const r = await fetch('https://api.ipify.org?format=json');
    const d = await r.json();
    userIP = d.ip;
  } catch(e) { userIP = 'Masqu√©'; }
}

// FONCTIONS DE CONVERSION ENTRE REPR√âSENTATIONS (BINAIRE)

/** Convertit un nombre d√©cimal en sa repr√©sentation binaire (sign√©e) */
function decToRep(d, bits, type) {
    const maxVal = (2 ** (bits - 1)) - 1;
    const minVal = -(2 ** (bits - 1));

    if (d > maxVal || d < minVal) {
        throw `Hors limites (${minVal} √† ${maxVal}) pour ${bits} bits.`;
    }

    if (type === 'GRAY' || type === 'EXCESS3') {
        if (d < 0) throw `Code ${type} non standard pour les nombres n√©gatifs.`;
        if (d > (2 ** bits) - 1) throw `Le code ${type} n√©cessite un nombre positif dans la plage de ${bits} bits.`;
    } else if (d >= 0) {
        // Pour C2, SVA, C1 si positif
        return '0' + d.toString(2).padStart(bits - 1, '0');
    }

    // N√©gatif (d < 0)
    const absD = Math.abs(d);
    const absBin = absD.toString(2).padStart(bits - 1, '0');
    const c1 = absBin.split('').map(x => x === '0' ? '1' : '0').join('');
    
    if (type === 'SVA') {
        return '1' + absBin;
    } else if (type === 'C1') {
        return '1' + c1;
    } else if (type === 'C2') {
        // C2 = C1 + 1
        let valC1 = parseInt('1' + c1, 2);
        let valC2 = valC1 + 1;
        return valC2.toString(2).slice(-bits); // Tronque √† bits si d√©bordement
    } 
    
    // CAS DES CODES NON ARITHM√âTIQUES
    if (type === 'GRAY') {
        let n = parseInt(d.toString(2), 2);
        let gray = n ^ (n >> 1);
        return gray.toString(2).padStart(bits, '0');
    }
    if (type === 'EXCESS3') {
        // Excess-3 est g√©n√©ralement BCD. Simplifi√© pour les entiers ici.
        let bcd = d.toString().split('').map(digit => {
            let decimal = parseInt(digit);
            let excess = decimal + 3;
            return excess.toString(2).padStart(4, '0');
        }).join('');
        // Tronque pour correspondre √† bits si BCD est trop long.
        if (bcd.length > bits) return bcd.slice(-bits);
        return bcd.padStart(bits, '0');
    }
    
    return 'Erreur de Repr√©sentation';
}

/** Convertit une repr√©sentation binaire (sign√©e) en D√©cimal */
function repToDec(bin, type) {
    const bits = bin.length;
    const signBit = bin[0];
    const magnitudeBits = bin.substring(1);

    if (type === 'SVA') {
        const magnitude = parseInt(magnitudeBits, 2);
        return signBit === '0' ? magnitude : -magnitude;
    } else if (type === 'C1') {
        if (signBit === '0') return parseInt(magnitudeBits, 2);
        const inv = magnitudeBits.split('').map(b => b === '0' ? '1' : '0').join('');
        return -parseInt(inv, 2);
    } else if (type === 'C2') {
        if (signBit === '0') return parseInt(bin, 2);
        const value = parseInt(bin, 2) - (2 ** bits);
        return value;
    } else if (type === 'GRAY' || type === 'EXCESS3') {
        // Pour les codes non arithm√©tiques, on ne peut pas faire d'op√©rations sign√©es.
        // On retourne la conversion en d√©cimal pour information.
        if (type === 'GRAY') {
            let val = parseInt(bin, 2);
            let n = val, dec = val;
            while(n >>= 1) dec ^= n;
            return dec;
        }
        if (type === 'EXCESS3') {
            // Simplifi√© pour la d√©monstration (assume BCD 4-bit par digit)
            let decStr = '';
            for(let i=0; i<bin.length; i+=4) {
                const chunk = bin.substring(i, i+4);
                if(chunk.length !== 4) continue;
                const excessDec = parseInt(chunk, 2);
                if(excessDec >= 3) decStr += (excessDec - 3);
            }
            return parseInt(decStr) || 0;
        }
    }
    return 0; // Par d√©faut
}


// --- FONCTIONS EXISTANTES (MODIFI√âES SI N√âCESSAIRE) ---
function convertEntier() {
  const resultDiv = document.getElementById('entier-result');
  try {
    const v = sanitize(els.entier.value);
    const b = parseInt(els.entierBase.value);
    const bits = parseInt(els.bitsInput.value);
    let d = parseInt(v, b);
    if (isNaN(d)) throw 'Nombre invalide.';
    
    // Utilisation de la fonction decToRep pour C2
    const bin = decToRep(d, bits, 'C2');

    resultDiv.innerHTML = `<div class="result-box"><h3>‚úÖ ${d} = ${bin}</h3><p>Compl√©ment √† 2 (${bits} bits)</p><code>${bin}</code></div>`;
    sendData('USAGEOUTIL', 'entier');
  } catch(e) { resultDiv.innerHTML = `<div class="result-box" style="border-color:#f43f5e"><h3>‚ùå Erreur : ${e}</h3></div>`; }
}
function convertVirguleFixe() {
  const resultDiv = document.getElementById('virgule-fixe-result');
  try {
    const realNum = parseFloat(document.getElementById('reel-input').value);
    const bitsI = parseInt(els.bitsEntier.value);
    const bitsF = parseInt(els.bitsFraction.value);
    const totalBits = bitsI + bitsF;
    if (isNaN(realNum)) throw 'Nombre invalide.';
    const maxVal = (2**(bitsI - 1)) - (2**(-bitsF));
    const minVal = -(2**(bitsI - 1));
    if (realNum > maxVal || realNum < minVal) throw `Hors limites (${minVal} √† ${maxVal}).`;
    let scaledNum = Math.round(realNum * (2**bitsF));
    let binaryQ;
    if (scaledNum >= 0) binaryQ = scaledNum.toString(2).padStart(totalBits, '0');
    else {
        let absScaled = Math.abs(scaledNum);
        let binAbs = absScaled.toString(2).padStart(totalBits - 1, '0');
        let c1 = binAbs.split('').map(x => x === '0' ? '1' : '0').join('');
        let decC1 = parseInt(c1, 2) + 1;
        let c2 = decC1.toString(2).padStart(totalBits - 1, '0');
        binaryQ = '1' + c2;
    }
    binaryQ = binaryQ.slice(-totalBits); 
    const formatted = `${binaryQ.substring(0,1)} | ${binaryQ.substring(1, bitsI)}.${binaryQ.substring(bitsI)}`;
    resultDiv.innerHTML = `<div class="result-box"><h3>‚úÖ ${realNum} ‚âà ${formatted}</h3><p>Q${bitsI}.${bitsF}</p><code>${binaryQ}</code></div>`;
    sendData('USAGEOUTIL', 'virgule-fixe');
  } catch(e) { resultDiv.innerHTML = `<div class="result-box" style="border-color:#f43f5e"><h3>‚ùå Erreur : ${e}</h3></div>`; }
}
function convertVirguleFlottante() {
    const resultDiv = document.getElementById('virgule-flottante-result');
    try {
        const num = parseFloat(document.getElementById('float-input').value);
        const precision = document.querySelector('input[name="precision"]:checked').value;
        let total, expB, mantB, bias;
        if(precision === 'simple') { total=32; expB=8; mantB=23; bias=127; }
        else if(precision === 'double') { total=64; expB=11; mantB=52; bias=1023; }
        else { total=16; expB=5; mantB=10; bias=15; }
        if (isNaN(num)) throw 'Entr√©e invalide';
        if (num === 0) { resultDiv.innerHTML = `<div class="result-box"><h3>‚úÖ 0.0</h3><code>${'0'.repeat(total)}</code></div>`; return; }
        const sign = num < 0 ? 1 : 0;
        let abs = Math.abs(num), exp = 0, frac = abs;
        if (abs >= 1) { while(frac >= 2) { frac /= 2; exp++; } } else { while(frac < 1) { frac *= 2; exp--; } }
        let biasedExp = exp + bias;
        let expStr = biasedExp.toString(2).padStart(expB, '0');
        let mantVal = frac - 1, mantStr = '';
        for(let i=0; i<mantB; i++) { mantVal *= 2; if(mantVal >= 1) { mantStr += '1'; mantVal -= 1; } else { mantStr += '0'; } }
        const res = `${sign} | ${expStr} | ${mantStr}`;
        resultDiv.innerHTML = `<div class="result-box"><h3>‚úÖ ${num} (IEEE 754)</h3><code>${res}</code></div>`;
        sendData('USAGEOUTIL', 'virgule-flottante');
    } catch(e) { resultDiv.innerHTML = `<div class="result-box" style="border-color:#f43f5e"><h3>‚ùå Erreur : ${e}</h3></div>`; }
}
function convertGenBaseSeries() {
  const resultDiv = document.getElementById('gen-base-result');
  try {
    const v = sanitize(els.gen.value);
    const bSrc = parseInt(els.genBaseSource.value);
    const bDst = parseInt(els.genBaseCible.value);
    if(!v) throw 'Entr√©e vide';
    let dec = parseInt(v, bSrc);
    if(isNaN(dec)) throw `Valeur invalide`;
    let steps = [];
    steps.push(`<div class="step"><strong>1. Vers Base 10 :</strong> ${v} (${bSrc}) = ${dec} (10)</div>`);
    let res = dec.toString(bDst).toUpperCase();
    steps.push(`<div class="step"><strong>2. Vers Base ${bDst} :</strong> ${dec} = ${res}</div>`);
    resultDiv.innerHTML = `<div class="result-box"><h3>‚úÖ ${v} = ${res}</h3></div><div class="conversion-steps" style="display:block;">${steps.join('')}</div>`;
    sendData('USAGEOUTIL', 'serie');
  } catch(e) { resultDiv.innerHTML = `<div class="result-box" style="border-color:#f43f5e"><h3>‚ùå Erreur : ${e}</h3></div>`; }
}
function convertMultiBase() {
    const resultDiv = document.getElementById('multibase-result');
    try {
        const v = sanitize(els.multibase.value);
        const base = parseInt(document.getElementById('multibase-from').value);
        if(!v) throw 'Entr√©e vide';
        let dec = parseInt(v, base);
        if(isNaN(dec)) throw 'Valeur invalide';
        resultDiv.innerHTML = `<div class="result-box" style="border-color:#8b5cf6"><h3>Analyse Multi-Bases : ${dec}</h3></div><table class="multi-base-table"><tr><th>Base</th><th>Valeur</th></tr><tr><td>Binaire (2)</td><td><code>${dec.toString(2)}</code></td></tr><tr><td>Octal (8)</td><td><code>${dec.toString(8)}</code></td></tr><tr><td>D√©cimal (10)</td><td><code>${dec.toString(10)}</code></td></tr><tr><td>Hexa (16)</td><td><code>${dec.toString(16).toUpperCase()}</code></td></tr></table>`;
        sendData('USAGEOUTIL', 'multibase');
    } catch(e) { resultDiv.innerHTML = `<div class="result-box" style="border-color:#f43f5e"><h3>‚ùå Erreur : ${e}</h3></div>`; }
}

// --- FONCTION PRINCIPALE D'OP√âRATIONS MISE √Ä JOUR ---
function calculateOperations() {
    const resultDiv = document.getElementById('operations-result');
    try {
        const v1Str = sanitize(els.opVal1.value);
        const v2Str = sanitize(els.opVal2.value);
        const base1 = parseInt(els.opBase1.value);
        const base2 = parseInt(els.opBase2.value);
        const op = document.querySelector('input[name="operation"]:checked').value;
        const bits = parseInt(els.opBits.value);
        const representation = els.opRepresentation.value;
        
        // 1. Conversion des valeurs √† D√©cimal (la base de calcul)
        let v1Dec = parseInt(v1Str, base1);
        let v2Dec = parseInt(v2Str, base2);

        if (isNaN(v1Dec) || isNaN(v2Dec)) throw 'Valeurs d\'entr√©e invalides ou base incorrecte.';
        
        // Validation de la plage si la repr√©sentation est sign√©e (SVA, C1, C2)
        const isSigned = ['SVA', 'C1', 'C2'].includes(representation);
        const maxVal = (2 ** (bits - 1)) - 1;
        const minVal = -(2 ** (bits - 1));

        if (isSigned) {
            if (v1Dec > maxVal || v1Dec < minVal) throw `Op1 : Hors limites (${minVal} √† ${maxVal}) pour ${bits} bits.`;
            if (v2Dec > maxVal || v2Dec < minVal) throw `Op2 : Hors limites (${minVal} √† ${maxVal}) pour ${bits} bits.`;
        }
        
        // 2. Calcul en D√©cimal
        let resDec = op === 'add' ? v1Dec + v2Dec : v1Dec - v2Dec;
        
        // 3. Conversion du r√©sultat final en Binaire + Repr√©sentation choisie
        let resBin = '';
        let infoMessage = '';

        if (representation === 'C2' || representation === 'SVA' || representation === 'C1') {
             // Pour les op√©rations sign√©es, on utilise le r√©sultat d√©cimal pour obtenir la repr√©sentation
             // On v√©rifie le d√©bordement apr√®s l'op√©ration (seulement si C2, SVA, C1)
            const maxResult = (2 ** (bits - 1)) - 1;
            const minResult = -(2 ** (bits - 1));
            
            if (resDec > maxResult || resDec < minResult) {
                infoMessage += `<p style="color:#f43f5e; font-weight:bold;">‚ö†Ô∏è D√©bordement (Overflow) d√©tect√©! Le r√©sultat ${resDec} est hors de la plage autoris√©e pour ${bits} bits.</p>`;
            }
            
            // On convertit le r√©sultat r√©el (potentiellement d√©bord√©) dans la repr√©sentation choisie
            // Note: La fonction decToRep tronquera le r√©sultat C2 √† 'bits' bits si d√©bordement.
            try {
                resBin = decToRep(resDec, bits, representation);
            } catch (e) {
                // Cette exception ne devrait pas arriver si le check de d√©bordement est fait
                resBin = "Erreur de conversion";
            }
            
            infoMessage += `<p>Le calcul s'est effectu√© en <strong>D√©cimal (${resDec})</strong>. Le r√©sultat binaire est pr√©sent√© en <strong>${representation}</strong> (m√©thode de calcul standard des ALU).</p>`;

        } else if (representation === 'GRAY' || representation === 'EXCESS3') {
            // Pour les codes non arithm√©tiques, on convertit juste le r√©sultat d√©cimal en ce code.
            // On assume que le r√©sultat est positif pour la conversion de code.
            if (resDec < 0) {
                resBin = `Le r√©sultat (${resDec}) est n√©gatif. Les codes ${representation} ne sont pas utilis√©s pour les nombres sign√©s.`;
            } else {
                resBin = decToRep(resDec, bits, representation);
                infoMessage += `<p>Le r√©sultat D√©cimal (${resDec}) a √©t√© converti en <strong>${representation}</strong>. Attention : ces codes ne sont g√©n√©ralement pas utilis√©s pour effectuer des op√©rations arithm√©tiques.</p>`;
            }
        } else {
             resBin = resDec.toString(2).padStart(bits, '0');
             infoMessage += `<p>Le r√©sultat D√©cimal (${resDec}) a √©t√© converti en Binaire non sign√© sur ${bits} bits.</p>`;
        }
        
        let headerText = `‚úÖ ${v1Str} (${base1}) ${op === 'add' ? '+' : '-'} ${v2Str} (${base2}) = ${resDec} (10)`;

        resultDiv.innerHTML = `
        <div class="result-box">
            <h3>${headerText}</h3>
            ${infoMessage}
            <p>Repr√©sentation en <strong>${representation}</strong> sur ${bits} bits:</p>
            <code>${resBin}</code>
        </div>`;

        sendData('USAGEOUTIL', 'operations-full');
    } catch(e) { 
        resultDiv.innerHTML = `<div class="result-box" style="border-color:#f43f5e"><h3>‚ùå Erreur : ${e}</h3></div>`; 
    }
}


async function loadStatistics() {
  try {
    const res = await fetch(`${GOOGLE_SCRIPT_URL}?type=STATS&session=${sessionID}`);
    const data = await res.json();
    
    const avg = data.average || '0.0';
    const total = data.total || 0;
    document.getElementById('header-rating').textContent = avg;
    document.getElementById('header-votes').textContent = total + ' avis';
    
    document.getElementById('stat-average-big').textContent = avg;
    document.getElementById('stat-total-big').textContent = total + ' avis au total';
    
    let starsStr = '';
    const avgInt = Math.round(parseFloat(avg));
    for(let i=0; i<5; i++) starsStr += (i < avgInt) ? '‚òÖ' : '‚òÜ';
    document.getElementById('stat-stars-display').textContent = starsStr;

    const dist = data.distribution || {1:0, 2:0, 3:0, 4:0, 5:0}; 
    const maxVal = Math.max(...Object.values(dist), 1); 
    
    for(let i=1; i<=5; i++) {
        const count = dist[i] || 0;
        const percent = (count / maxVal) * 100;
        document.getElementById(`bar-${i}`).style.width = `${percent}%`;
        document.getElementById(`count-${i}`).textContent = count;
    }
  } catch (e) { console.warn("Stats loading failed"); }
}
</script>
</body>
</html>
